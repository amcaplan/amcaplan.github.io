<!doctype html>
  <!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
  <!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
  <!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
  <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->

  
    
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Closures and Callbacks: Running Arbitrary Task Sets Synchronously in JavaScript - AMC: Aspiring Master of Code</title>
    <meta name="author" content="Ariel Caplan">
    
    <meta name="description" content="Closures and Callbacks: Running Arbitrary Task Sets Synchronously in JavaScript Aug 24th, 2014 JavaScript Programming On the Vitals Choice team, we &hellip;">
    
    <meta name="viewport" content="width=device-width">
    <link rel="canonical" href="http://amcaplan.ninja/blog/2014/08/24/closures-and-callbacks-running-arbitrary-task-sets-synchronously-in-javascript">
    
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet">
    <link href="/atom.xml" rel="alternate" title="AMC: Aspiring Master of Code" type="application/atom+xml">
  </head>


  <body >

    <header>
      <div class="grid-wrapper">
  <div class="grid">

    <div class="grid__item two-fifths lap-four-sixths palm-one-whole">
  <a href="/" class="site-title">AMC: Aspiring Master of Code</a>
</div>

<div class="grid__item three-fifths lap-two-sixths palm-one-whole">
  <nav>
    <input type="checkbox" id="toggle">
<label for="toggle" class="toggle" data-open="Main Menu" data-close="Close Menu"></label>
<ul class="menu pull-right">
  <li><a href="/">Home</a></li>
  <li><a href="/blog/">Blog</a></li>
</ul>
  </nav>
</div>

  </div>
</div>
    </header>

    

    <div class="grid-wrapper">
      <div class="grid grid-center">
        
        <div class="grid__item two-thirds lap-one-whole palm-one-whole">
        

          <article class="post">
  <header>
  
  <h1 class="title indent">Closures and Callbacks: Running Arbitrary Task Sets Synchronously in JavaScript</h1>
  

  
  <div class="meta clearfix">
    








  


<time class="pull-left" datetime="2014-08-24T16:25:29-04:00" pubdate data-updated="true"><i class="icon-calendar"></i> Aug 24<span>th</span>, 2014</time>
    

  <div class="pull-left">
    <i class="icon-tags"></i>
    <ul class="tags unstyled">
    
      
        <li><a class='category' href='/blog/categories/javascript/'>JavaScript</a></li>
      
        <li><a class='category' href='/blog/categories/programming/'>Programming</a></li>
      
    
    </ul>
  </div>

    
  </div>
  
</header>




  <p>On the Vitals Choice team, we have divided our product into a number of apps.
Each of those apps has one running instance per environment , and we have
several environments.  So as you might imagine, making sure updated code
gets propagated through all those places at the right time can be quite
the task.  Luckily, we have a Hubot instance which does most of the heavy
lifting, but even issuing all the Hubot commands for every single app makes you
wonder: shouldn&rsquo;t there be a way to automate this better?</p>

<p>Well, it turns out that an attempt had been made in the past, but we ran into
a problem: JavaScript&rsquo;s asynchronicity.  The server hosting Hubot was suddenly
told to update all the apps for a particular environment, and the simultaneous
processes overwhelmed the CPU and memory.</p>

<p>Considering the problem, I realized that callbacks were the way to go.  Hubot
comes with an evented system, which we could utilize to force Hubot to only
launch one app at a time.  Here&rsquo;s what I came up with, and what I learned along
the way.</p>

<!-- more -->


<p><em>[Note: code examples have been simplified for readability, and proprietary
secrets have been removed.]</em></p>

<h3>Step 1: Implement callbacks for the deploy script</h3>

<p>Initially, groundwork needed to be laid for post-deploy callbacks.  This was
relatively simple to implement (all examples in CoffeeScript):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">deploy = </span><span class="nf">(app, env, callback) -&gt;</span>
</span><span class='line'>  <span class="c1"># code to deploy the app, including spawning a Shell script, abstracted</span>
</span><span class='line'>  <span class="c1"># in JavaScript by an object held in the variable &#39;script&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">script</span><span class="p">.</span><span class="nx">on</span> <span class="s">&#39;close&#39;</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">callback</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Step 2: Create a function for each app</h3>

<p>After quickly setting up a <code>robot.respond</code> function (which is how Hubot
responds to a particular chat command), calling a <code>deployAll</code> function, I
turned to the hard problem of setting up a series of functions to deploy all
apps, one after the other.  I had a variable accessible as
<code>robot.brain.PROJECTS</code>, which was a collection of all the app names, so I
thought to iterate through all the apps, each time capturing the previous
function as a callback of the new function.  This would effectively create
a stack of functions that would be executed one by one, exactly as I described.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">deployAll = </span><span class="nf">(env, msg)-&gt;</span>
</span><span class='line'>  <span class="nv">callback = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">msg</span><span class="p">.</span><span class="nx">send</span> <span class="s">&quot;Finished deploying all the apps!&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="nx">app</span> <span class="k">in</span> <span class="nx">robot</span><span class="p">.</span><span class="nx">brain</span><span class="p">.</span><span class="nx">PROJECTS</span>
</span><span class='line'>    <span class="c1"># Reassign `callback` to a new function...</span>
</span><span class='line'>    <span class="nv">callback = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="c1"># which passes the current `callback` as a callback to `deploy`</span>
</span><span class='line'>      <span class="nx">deploy</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">callback</span><span class="p">()</span> <span class="c1"># Start the chain!</span>
</span></code></pre></td></tr></table></div></figure>


<p>It all seemed to make sense, until I actually tested it.  For some reason,
it just tried to deploy the last app again and again.  What gives?</p>

<h3>Step 2.5: Grokking Scope and Lazy Function Evaluation</h3>

<p>It turns out that in the loop, when I redefined <code>callback</code>, it associated the
<code>callback</code> variable with a new function, but within the function, it didn&rsquo;t
yet do anything with the line <code>deploy(app, env, callback)</code>.  This is because
functions exist within a particular closure; they will be evaluated as though
they were run in the place where they were defined, with access to all local
variables, but those variables are accessed when the function is actually run,
NOT when the function is defined.</p>

<p>Here&rsquo;s a simpler example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">i = </span><span class="mi">0</span>
</span><span class='line'><span class="nv">logger = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">i</span><span class="o">++</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
</span><span class='line'><span class="nx">logger</span><span class="p">()</span> <span class="c1"># =&gt; 1</span>
</span><span class='line'><span class="nx">logger</span><span class="p">()</span> <span class="c1"># =&gt; 2</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="nf">(i) =&gt;</span> <span class="mi">2</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can see that <code>i</code> is defined in the outer scope, modified in the inner scope,
and that change persists in the outer scope.</p>

<p>Let&rsquo;s now look at an example closer to our situation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">i = </span><span class="mi">0</span>
</span><span class='line'><span class="nv">logger = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span>
</span><span class='line'><span class="nv">i = </span><span class="mi">7</span>
</span><span class='line'><span class="nx">logger</span><span class="p">()</span> <span class="c1"># =&gt; 7</span>
</span></code></pre></td></tr></table></div></figure>


<p>As we can see, the <code>i</code> inside the function is not fixed, but rather depends on
what happens in its closure at any point before the function is actually
called.</p>

<p>Here&rsquo;s one last example, with a nested function like we had:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">callbackRunner = </span><span class="nf">(callback) -&gt;</span>
</span><span class='line'>  <span class="nx">callback</span><span class="p">()</span>
</span><span class='line'><span class="nv">onePrinter = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="nx">callbackRunner</span><span class="p">(</span><span class="nx">onePrinter</span><span class="p">)</span> <span class="c1"># =&gt; 1</span>
</span><span class='line'>
</span><span class='line'><span class="nv">cbRoP = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">callbackRunner</span><span class="p">(</span><span class="nx">onePrinter</span><span class="p">)</span>
</span><span class='line'><span class="nx">cbRoP</span><span class="p">()</span> <span class="c1"># =&gt; 1</span>
</span><span class='line'>
</span><span class='line'><span class="nv">onePrinter = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s">&quot;one&quot;</span><span class="p">)</span>
</span><span class='line'><span class="nx">cbRoP</span><span class="p">()</span> <span class="c1"># =&gt; &quot;one&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>By redefining <code>onePrinter</code> in the outer scope, we changed what <code>cbRoP</code> does.
This is because inside <code>cbRoP</code>, where <code>onePrinter</code> is referenced, that variable
is evaluated only when <code>cbRoP</code> is actually called.  The first time, <code>onePrinter</code>
prints out 1, but the second time, it prints out &ldquo;one&rdquo;.  Even within <code>cbRoP</code>,
<code>onePrinter</code> has been redefined.</p>

<h3>Step 3: Create a Custom Scope</h3>

<p>The solution to our problem was to create a scope where the callback wouldn&rsquo;t
change.  Here&rsquo;s the code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">deployAll = </span><span class="nf">(env, msg)-&gt;</span>
</span><span class='line'>  <span class="nv">callback = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">msg</span><span class="p">.</span><span class="nx">send</span> <span class="s">&quot;Finished deploying all the apps!&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">deployFunctionFactory = </span><span class="nf">(app, callback) -&gt;</span>
</span><span class='line'>    <span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">deploy</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> <span class="nx">app</span> <span class="k">in</span> <span class="nx">robot</span><span class="p">.</span><span class="nx">brain</span><span class="p">.</span><span class="nx">PROJECTS</span>
</span><span class='line'>    <span class="nv">callback = </span><span class="nx">deployFunctionFactory</span><span class="p">(</span><span class="nx">app</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">callback</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a bit of a mind-bender, so let&rsquo;s explain piece by piece.</p>

<ul>
<li><p><code>deployFunctionFactory</code> takes in a reference to an app and a function to
use as a callback.  It returns a function which, when called, will deploy
the app passed in, and use the callback that is passed in.  Since <code>callback</code>
is one of <code>deployFunctionFactory</code>&rsquo;s arguments, it has been captured in the
scope of the function, and nothing outside can change it in the future.</p></li>
<li><p>The <code>for</code> loop reassigns <code>callback</code> each time to a new function which is
produced on the spot by <code>deployFunctionFactory</code>.  The right side of the equals
sign is evaluated immediately, so <code>callback</code> is passed into
<code>deployFunctionFactory</code>, a new function is returned, and that new function is
assigned to <code>callback</code>.</p></li>
<li><p>The cycle repeats for each app, ultimately generating what is effectively
a stack of functions to be called, one after the other.</p></li>
<li><p>When the stack of functions is resolved on the last line, it starts by
running the anonymous function returned by <code>deployFunctionFactory</code> for the last
app in <code>robot.brain.PROJECTS</code>, since that&rsquo;s the last function that has been
added to the virtual stack.  That function calls <code>deploy</code> with the second-to-last
function (which deploys the second-to-last app) as a callback.  When the first
app deployed is done deploying, this callback is run, deploying the next app
in line.</p></li>
</ul>


<p>The logic is pretty complex, so here&rsquo;s a visual representation of what all this
code is accomplishing.  We will consider a case of 3 apps to keep it simple.
First, we build the function inside out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="mi">1</span><span class="p">.</span>  <span class="nv">callback = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">msg</span><span class="p">.</span><span class="nx">send</span> <span class="s">&quot;Finished deploying all the apps!&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="mi">2</span><span class="p">.</span>  <span class="nv">callback = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">deploy</span> <span class="s">&quot;app1&quot;</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>        <span class="nx">msg</span><span class="p">.</span><span class="nx">send</span> <span class="s">&quot;Finished deploying all the apps!&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="mi">3</span><span class="p">.</span>  <span class="nv">callback = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">deploy</span> <span class="s">&quot;app2&quot;</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>        <span class="nx">deploy</span> <span class="s">&quot;app1&quot;</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>          <span class="nx">msg</span><span class="p">.</span><span class="nx">send</span> <span class="s">&quot;Finished deploying all the apps!&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="mi">4</span><span class="p">.</span>  <span class="nv">callback = </span><span class="nf">-&gt;</span>
</span><span class='line'>      <span class="nx">deploy</span> <span class="s">&quot;app3&quot;</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>        <span class="nx">deploy</span> <span class="s">&quot;app2&quot;</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>          <span class="nx">deploy</span> <span class="s">&quot;app1&quot;</span><span class="p">,</span> <span class="nx">env</span><span class="p">,</span> <span class="nf">-&gt;</span>
</span><span class='line'>            <span class="nx">msg</span><span class="p">.</span><span class="nx">send</span> <span class="s">&quot;Finished deploying all the apps!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, when we call <code>callback</code>, the functions will be run outside in.  First,
app3 will be deployed.  When that&rsquo;s done, our <code>deploy</code> function knows to call
the callback, i.e. the next function, deploying app2.  When app2 finishes being
deployed, app1 will be deployed.  At the end, a message will be sent letting
you know all the apps have been deployed.</p>

<h3>Concluding Thoughts</h3>

<p>Using closures and callbacks properly can be a mentally exhausting endeavor.
However, when these factors are properly considered and utilized, you can
accomplish some pretty powerful stuff.</p>

<p>I personally had to try a few iterations before I came up with a workable
solution in this case, but the results were quite satisfying, and it got the
job done.  In the future, if we add apps to <code>robot.brain.PROJECTS</code>, the
<code>deployAll</code> function won&rsquo;t have to be changed; it will just add more layers
to the nested function we&rsquo;ve built.</p>

<p>Using closures and callbacks, we&rsquo;ve managed to build a function that will run
an arbitrary number of tasks synchronously.  Sweet!</p>


</article>

 
<section id="disqus">
  <h1 class="indent title">Comments</h1>
  <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>


        </div>

        
        <aside id="sidebar" class="grid__item one-third lap-one-whole palm-one-whole">
          <div class="grid">

  
<section class="social aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">
    Connect With Me
  </h1>
  <ul class="unstyled">
    
    
    <li><a class="github" href="//github.com/amcaplan"><i class="icon-github"></i> Github</a></li>
    
    
    
    
    
    <li><a class="twitter" href="//twitter.com/amcaplan"><i class="icon-twitter"></i> Twitter</a></li>
    
  </ul>
</section>


  <section id="recent-posts" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">Recent Posts</h1>
  <ul class="divided">
    
      <li class="post">
        <a href="/blog/2015/01/13/flag-your-features-with-rollout-and-degrade/">Flag Your Features with Rollout and Degrade</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/24/closures-and-callbacks-running-arbitrary-task-sets-synchronously-in-javascript/">Closures and Callbacks: Running Arbitrary Task Sets Synchronously in JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/17/asynchronous-javascript-without-failing-capybara-tests/">Asynchronous JavaScript - Without Failing Capybara Tests</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/29/how-to-stay-classy-with-ruby-variables/">How to Stay Classy With Ruby Variables</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/01/coffeescript-101/">CoffeeScript 101</a>
      </li>
    
  </ul>
</section>

<section id="github-repos" class="aside-module grid__item one-whole lap-one-half">
  <h1 class="title delta">
    GitHub Repos
    
    <small class="pull-right">
      <a class="btn" href="//github.com/amcaplan" title="@amcaplan on GitHub" target="_blank">
        <i class="icon-external-link"></i>
      </a>
    </small>
    
  </h1>
  <ul id="gh_repos" class="divided">
    <li class="loading">
      <i class="icon-spinner icon-spin"></i>
    </li>
  </ul>
</section>




</div>

        </aside>
        
      </div>
    </div>

    <footer>
      <div class="grid-wrapper">
  <div class="grid">
    <div class="grid__item">
      <p class="copyright">
  All content by Ariel Caplan and licensed under <a href="//creativecommons.org/licenses/by-nc-sa/3.0/ie/">Creative Commons</a>.<br>
  Code under <a href="//github.com/coogie/oscailte/blob/master/README.md">MIT License</a>.
</p>
    </div>
  </div>
</div>

    </footer>

    <!--[if lt IE 7]>
      <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
    <![endif]-->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/md5.js"></script>
<script defer src="/javascripts/octopress.js"></script>




<script>
  var disqus_shortname = 'amcaplan';
  
    
    // var disqus_developer = 1;
    var disqus_identifier = 'http://amcaplan.ninja/blog/2014/08/24/closures-and-callbacks-running-arbitrary-task-sets-synchronously-in-javascript/';
    var disqus_url = 'http://amcaplan.ninja/blog/2014/08/24/closures-and-callbacks-running-arbitrary-task-sets-synchronously-in-javascript/';
    var disqus_script = 'embed.js';
  
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>




<script>
  $(document).ready(function(){
    if (!window.jXHR){
      var jxhr = document.createElement('script');
      jxhr.type = 'text/javascript';
      jxhr.src = '/javascripts/libs/jXHR.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jxhr, s);
    }

    github.showRepos({
      user: 'amcaplan',
      count: 0,
      skip_forks: true,
      target: '#gh_repos'
    });
  });
</script>
<script src="/javascripts/github.js"></script>






  </body>
</html>